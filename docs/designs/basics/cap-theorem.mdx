---
title: "CAP Theorem"
description : "Systems Design Basics"
sidebar_position: 1
---

The CAP theorem states that it is impossible for a distributed system to simultaneously provide more than two out of three of the following guarantees:
- Consistency: Every read receives the most recent write or an error.
- Availability: Every request receives a (non-error) response, without the guarantee that it contains the most recent write.
- Partition tolerance: The system continues to operate despite an arbitrary number of messages being dropped (or delayed) by the network between nodes.

<details>
    <summary>What is Consistency?</summary>
    - Consistency is the guarantee that all nodes in a distributed system will have the same data at the same time.
    - Consistency is usually measured as the time it takes for the data to be replicated across all nodes.
    - Consistency is usually measured in milliseconds.
    - A system that is highly consistent will have the same data across all nodes at the same time.
</details>

<details>
    <summary>What is Partition Tolerance?</summary>
    - Partition Tolerance is the ability of a system to continue to function even if the network is partitioned.
    - A system that is highly partition tolerant will continue to function even if the network is partitioned.
</details>

<details>
    <summary>What is Availability?</summary>
    - Availability is the time a system remains operational to perform its required function in a specific period.
    - Availability is usually measured as a percentage of uptime in a given year.
    - Availability = uptime / (uptime + downtime)
    - A system that is highly available will be able to provide service even if one or more of its components fail.
    - Any failing node can be replaced with a new node without affecting the service.
</details>

![Cap Theorem](./img/cap-thoerem-dig.png)

### CAP Theorem for Distributed Systems

Understanding the CAP theorem is crucial for designing distributed systems like newsfeed platforms. The CAP theorem states that a distributed system cannot simultaneously guarantee all three properties: Consistency, Availability, and Partition Tolerance.

```mermaid
graph TD
    subgraph "CAP Theorem: Properties of Distributed Systems"
        A[Availability<br/>System continues to function<br/>even with node failures]
        C[Consistency<br/>All users see the same data<br/>at the same time]
        P[Partition Tolerance<br/>System continues to function<br/>even if communication fails<br/>between nodes]
    end

    subgraph "Database Systems by CAP Combination"
        AP_Systems["Availability + Partition Tolerance (AP)<br/>Examples: Cassandra, CouchDB"]
        CP_Systems["Consistency + Partition Tolerance (CP)<br/>Examples: BigTable, MongoDB, HBase"]
        AC_Systems["Availability + Consistency (AC)<br/>Examples: RDBMS (Single-node)"]
        Not_Possible["All Three: Not Possible<br/>No distributed system can guarantee<br/>all three simultaneously"]
    end

    A --> AP_Systems
    P --> AP_Systems
    
    C --> CP_Systems
    P --> CP_Systems
    
    A --> AC_Systems
    C --> AC_Systems
    
    A --> Not_Possible
    C --> Not_Possible
    P --> Not_Possible

    style A fill:#ADD8E6,stroke:#333,stroke-width:3px
    style C fill:#FFB6C1,stroke:#333,stroke-width:3px
    style P fill:#FFD700,stroke:#333,stroke-width:3px

    style AP_Systems fill:#E0FFFF,stroke:#333,stroke-width:2px
    style CP_Systems fill:#FFE4E1,stroke:#333,stroke-width:2px
    style AC_Systems fill:#F0F8FF,stroke:#333,stroke-width:2px
    style Not_Possible fill:#F5F5DC,stroke:#FF0000,stroke-width:3px
```

#### CAP Theorem Implications for Newsfeed Systems

**For Newsfeed Systems, we typically choose AP (Availability + Partition Tolerance):**

- **Availability**: Users can always access their feed, even if some data is slightly stale
- **Partition Tolerance**: System continues working even if some servers are unreachable
- **Eventual Consistency**: Feed updates may take time to propagate, but eventually all users see the same data

**Why AP for Newsfeeds?**
- **User Experience**: Better to show slightly outdated content than no content at all
- **Scale**: Millions of users need constant access to their feeds
- **Tolerance**: Users can accept minor delays in seeing new posts from friends
- **Performance**: Allows for aggressive caching and optimization strategies

**Trade-offs:**
- Users might see posts in slightly different orders
- New posts might take a few seconds to appear in all followers' feeds
- Some users might see cached content while others see fresh content


